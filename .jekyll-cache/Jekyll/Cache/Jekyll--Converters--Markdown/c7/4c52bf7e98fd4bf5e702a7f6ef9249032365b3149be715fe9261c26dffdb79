I"“<p><img src="/assets/2020-06-27-why-we-should-build-our-go-application-as-cli-0.jpeg" alt="" /></p>

<p>So here we Go again, another opinion based on my experience create Go application. This time, i will discuss about CLI in Go and why itâ€™s matter. Atleast, itâ€™s matter for me because itâ€™s add operability to my application. Iâ€™ll explain later in this article.</p>

<blockquote>
  <p>A command-line interface (CLI) processes commands to a computer program in the form of lines of text. The program which handles the interface is called a command-line interpreter or command-line processor.</p>

</blockquote>

<p>Itâ€™s common for software engineer to use CLI, such as <code class="language-plaintext highlighter-rouge">cp</code>, <code class="language-plaintext highlighter-rouge">pwd</code>, <code class="language-plaintext highlighter-rouge">rm -rf /</code> (Please donâ€™t try the last one). Itâ€™s also common for programming language to have CLI to make development easier, take an example for <a href="https://guides.rubyonrails.org/command_line.html">Rails CLI</a>, or <a href="https://laravel.com/docs/7.x/artisan">Laravel Artisan CLI</a>.</p>

<p>But in this case, we will not make our Go application into CLI so itâ€™s make our development easier. Instead we will make it as an interface to make our application more operable.</p>

<p>In other programming language, debugging in production environment is so easy. But in go, where we compiled our application into a single binary program it could be difficult to debug what happen in production environment.</p>

<p>Imagine this scenario, where we create a service that has a lot of dependency like:</p>

<ul>
  <li>MYSQL</li>
  <li>Redis</li>
  <li>Service A</li>
  <li>Service B</li>
</ul>

<p><img src="/assets/2020-06-27-why-we-should-build-our-go-application-as-cli-1.png" alt="Example Scenario" /></p>

<p>In php or rails it could be so easy to check wether we could establish connection into our databases. In rails we could use <code class="language-plaintext highlighter-rouge">rails console</code> and type</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="p">.</span><span class="nf">establish_connection</span>
</code></pre></div></div>

<p>to do integration test to our databases. Also we could check how much pool in our database by using</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="p">.</span><span class="nf">connection_pool</span><span class="p">.</span><span class="nf">stat</span>
</code></pre></div></div>

<p>Or maybe doing some scripts that directly connect into our application business logic</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">OurService</span><span class="o">::</span><span class="no">ServiceA</span><span class="p">.</span><span class="nf">add_to_cart</span><span class="p">(</span><span class="ss">user_id: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">product_id: </span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<p>You might be thinking, what if we create GUI for something administrational like this? And just create monitoring to our databases so we could check it from monitoring dashboard instead of productions console.</p>

<p>My answer is, yes you could! Absolutely. Monitoring is essentials, i aggree with that. But this is the world of software engineering, where something everything could change. Imagine a scenario where you should change your database instance into a new one, you couldnâ€™t be deploy your application without knowing if it can connect into new database instance. You should deploy your application first, check if itâ€™s connect rightly into your new database instance, then change your traffic pointing to a new deployment or replace the current deployment with new config.</p>

<p>In rails you could do it so easily, because you have the ability to enter the console and just type what you need. But in Go? The simplest way to do it is run your server, curl into some API and see the response of that API. If itâ€™s return 500 then your config is wrong. There is also no guarantee if itâ€™s return 200 then your database config is okay.</p>

<p>Oh, and GUI for something administrational itâ€™s case by case. For big scale application itâ€™s a must, because there are administrational team which will be need that I assume. For team that consist of 2 engineer, no administrational team or small startup itâ€™s waste of time in my opinion. With GUI you just creating another layer of interface above of the CLI itself, when what you need is speed than CLI is your best friend.</p>

<p>So come the question, how you do it in Go? How to make your Go binary is more operable and adding some more function to it.</p>

<p>Here come the solution (atleast for me) <a href="https://github.com/spf13/cobra">Cobra CLI</a>. The same package which used by <a href="https://github.com/kubernetes/kubectl/blob/42bf054e195ad7984972b8d6939e3ce835cb8682/go.mod#L31">kubectl</a>.</p>

<p>With this package we could create our <code class="language-plaintext highlighter-rouge">./api</code> Go binary into Something like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Example CLI command in Go using cobra.

Usage:
  our_service [flags]
  our_service [command]

Available Commands:
  help               Help about any command
  ping:mysql         Check mysql availability
  ping:redis         Check redis availability
  ping:service_a     Ping service a.
  ping:service_b     Ping service b.
  run:api            Run API
  script:add_to_cart Add to cart based on user_id and product_id

Flags:
  -h, --help   help for our_service

Use "our_service [command] --help" for more information about a command.
</code></pre></div></div>

<p>Now, doing integration test with your Golang binary is so easy. If you want to test mysql connection, just type <code class="language-plaintext highlighter-rouge">./our_service ping:mysql</code> and it will run based on the connection logic of your application. Or if you want to run script in your golang binary just type <code class="language-plaintext highlighter-rouge">./our_service script:add_to_cart [user_id] [product_id]</code>.</p>

<p>You can even install your binary into you <code class="language-plaintext highlighter-rouge">/usr/local/bin</code> by using <code class="language-plaintext highlighter-rouge">go install</code>, then next time you could run your service just with <code class="language-plaintext highlighter-rouge">our_service run:api</code>, no need to compiling it.</p>

<p>This is the sample respository that i create during creating this article to give you more visibility about the code. <a href="https://github.com/insomnius/example-go-cli">Insomnius/Example-Go-Cli</a>.</p>

<p>Thatâ€™s it, i hope you get some nice insight from this article that you can use later in your project. Thanks for reading.</p>
:ET